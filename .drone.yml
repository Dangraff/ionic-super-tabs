---
kind: pipeline
type: docker
name: default

clone:
  depth: 1

steps:
- name: Install node modules
  image: node:12-alpine
  commands:
  - npm install
  - npx lerna bootstrap

- name: Build
  image: node:12-alpine
  commands:
  - npm run build

- name: Publish
  image: node:12
  when:
    event:
    - tag
  environment:
    NPM_TOKEN:
      from_secret: npm_token
  commands:
  - cd core && npm publish && cd ../
  - cd angular/dist && npm publish

---
kind: signature
hmac: c421ab9aa245287802d71603ce545a33c3b25fa7c1ef9c2607adf46fb7e0a919

...
