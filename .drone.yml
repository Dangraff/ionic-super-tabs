---
kind: pipeline
type: docker
name: default

clone:
  depth: 1

steps:
- name: Install node modules
  image: node:12-alpine
  commands:
  - npm install
  - npx lerna bootstrap

- name: Build
  image: node:12-alpine
  commands:
  - npm run build

- name: Publish
  image: node:12
  when:
    event:
    - tag
  environment:
    NPM_TOKEN:
      from_secret: npm_token
  commands:
  - echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN}" >> core/.npmrc
  - cp core/.npmrc angular/dist/
  - cd core && npm publish && cd ../
  - cd angular/dist && npm publish

#- name: Update example project
#  image: plugins/downstream
#  settings:
#    server: https://drone.zyra.ca
#    token:
#      from_secret: drone_token
#    repositories:
#    - zyra/ionic-super-tabs-example
#    fork: true

---
kind: signature
hmac: 2cbcbb2572a12957793641846db031d168d8f5f0f64e5f8fc05353f015c12805

...
